---
title: "World Hapiness Data (2015-2019)"
output: html_document
---
```{r}
#install.packages('tidyverse')
#install.packages('skimr')
#install.packages('ggpubr')
library(readxl)
library(dplyr)
library(ggplot2)
library(skimr)
library(tidyr)
library(reshape2)
library(ggpubr)
# setwd("C:/ELS/RprojectsScrpit/case20220610")
# setwd("C:/Users/kyle/Documents/Master Program/Data Science/Programming for Data Science/Programming-For-Data-Science")
```

# Load the data
```{r}
df = read_excel("World Hapiness Data (2015-2019).xlsx", sheet = "Sheet1")
head(df)

```

#briefly statistic view the data
```{r}
print(paste("The amount of rows in the dataset is: ",dim(df)[1]))
print(paste("The amount of columns in the dataset is: ",dim(df)[2]))
print(paste("the column names in this dataset are:", paste(shQuote(colnames(df)), collapse=", ")))
```

#Change column names
```{r}

df = plyr::rename(df, replace = c("Happiness Rank" = "Happiness.Rank", 
                                  "Happiness Score" = "Happiness.Score",
                                  "Economy (GDP per Capita)" = "Economy..GDP.per.Capita.",
                                  "Health (Life Expectancy)" = "Health..Life.Expectancy.",
                                  "Trust (Government Corruption)"  = "Trust..Government.Corruption."))
```

```{r}
colnames(df)
str(df)
summary(df)
df$Trust..Government.Corruption. = as.numeric(df$Trust..Government.Corruption.)
```

```{r}
str(df)
summary(df)
```
## Omit NA Data
```{r}
df = na.omit(df)
str(df)
summary(df)
```


Due to the data is describing the happiness score and relative factors for countries accross different years. So, it is important to view the uniformity of the data in Year column of the data.

## Country and Region counts groupby Year
```{r}
aggregate(df$Country, by=list(df$Year), FUN=length)
```

From the table shown as above, the number of countries involved in this dataset for different year is differnt. Therefore, it is neccessary to make an intersection of them to get the most common country list.
```{r}

Country_2015 = subset(df, Year == 2015)$Country
Country_2016 = subset(df, Year == 2016)$Country
Country_2017 = subset(df, Year == 2017)$Country
Country_2018 = subset(df, Year == 2018)$Country
Country_2019 = subset(df, Year == 2019)$Country


```

```{r}
common_country =intersect(intersect(intersect(intersect(Country_2015, Country_2016),Country_2017),Country_2018),Country_2019)
length(common_country)
```
Therefore, there are 142 countries' data existing accross from 2015-2019 in this dataset.Then we need to filter the orginial dataset by this common_country list.
```{r}

df1 = subset(df,Country %in% common_country)
print(paste("The amount of rows in the dataset is: ",dim(df1)[1]))
print(paste("The amount of columns in the dataset is: ",dim(df1)[2]))

```
```{r}
str(df1)
```
## statistic view of the new df1
```{r}

skimr::skim_without_charts(df1)
```
## The 10 happiest countries in 2015
```{r}
df1 %>%
  filter(Year == 2015) %>%
  arrange(-Happiness.Score) %>%
  slice_head(n=10) %>%
  ggplot(aes(reorder(Country, Happiness.Score), Happiness.Score)) +
  geom_point(colour = "red", size = 3) +
  theme(text=element_text(size=10)) + 
  coord_flip() +
  labs(title = "The 10 happiest countries in 2015", x = "")


```
## The 10 happiest countries in 2016
```{r}
df1 %>%
  filter(Year == 2016) %>%
  arrange(-Happiness.Score) %>%
  slice_head(n=10) %>%
  ggplot(aes(reorder(Country, Happiness.Score), Happiness.Score)) +
  geom_point(colour = "red", size = 3) +
  theme(text=element_text(size=10)) + 
  coord_flip() +
  labs(title = "The 10 happiest countries in 2016", x = "")


```
## The 10 happiest countries in 2017

```{r}
df1 %>%
  filter(Year == 2017) %>%
  arrange(-Happiness.Score) %>%
  slice_head(n=10) %>%
  ggplot(aes(reorder(Country, Happiness.Score), Happiness.Score)) +
  geom_point(colour = "red", size = 3) +
  theme(text=element_text(size=10)) + 
  coord_flip() +
  labs(title = "The 10 happiest countries in 2017", x = "")


```
## The 10 happiest countries in 2018

```{r}
df1 %>%
  filter(Year == 2018) %>%
  arrange(-Happiness.Score) %>%
  slice_head(n=10) %>%
  ggplot(aes(reorder(Country, Happiness.Score), Happiness.Score)) +
  geom_point(colour = "red", size = 3) +
  theme(text=element_text(size=10)) + 
  coord_flip() +
  labs(title = "The 10 happiest countries in 2018", x = "")


```
## The 10 happiest countries in 2019

```{r}
df1 %>%
  filter(Year == 2019) %>%
  arrange(-Happiness.Score) %>%
  slice_head(n=10) %>%
  ggplot(aes(reorder(Country, Happiness.Score), Happiness.Score)) +
  geom_point(colour = "red", size = 3) +
  theme(text=element_text(size=10)) + 
  coord_flip() +
  labs(title = "The 10 happiest countries in 2019", x = "")


```



```{r}
Region_Yearavg_HappyScore = data.frame(aggregate(df$Happiness.Score, by=list(df$Year,df$Region), FUN=mean))
colnames(Region_Yearavg_HappyScore)<-c("Year","Region","Mean_HappyScore")
Region_Yearavg_HappyScore
```

```{r}

ggplot(Region_Yearavg_HappyScore,aes(x = Year,y = Mean_HappyScore,fill = Region))+
  geom_bar(stat = "identity",position = "dodge")
```
## The top 3 happiness region are: Australia and New Zealand, North America and Western Europe


## from 2015 to 2019, Mean Happiness score by regions:
```{r}
df1 %>%
  group_by(Region) %>%
  summarise(mscore = mean(Happiness.Score)) %>%
  ggplot(aes(reorder(Region, mscore), mscore)) +
  geom_point() +
  theme_bw() +
  
  coord_flip() +
  labs(title = "Happiness Score by Regions",
       x = "", y = "Average happiness score")

```



## from 2015 to 2019, Mean Happiness score by counntries:
```{r}
df1 %>%
  group_by(Country) %>%
  summarise(mscore = mean(Happiness.Score)) %>%
  arrange(-mscore) %>%
  slice_head(n=10) %>%
  
  ggplot(aes(reorder(Country, mscore), mscore)) +
  geom_point() +
  theme_bw() +
  
  coord_flip() +
  labs(title = "Happiness Score by Country",
       x = "", y = "Average happiness score")
```
Top 10 Mean Happiness score by counntries trends by years

```{r}
Top10_happy_country_DF = df1 %>%
  group_by(Country) %>%
  summarise(mscore = mean(Happiness.Score)) %>%
  arrange(-mscore) %>%
  slice_head(n=10)

Top10_happy_country_DF_list = c(Top10_happy_country_DF$Country)

df1_Top10_happy_country = subset(df1,Country %in% Top10_happy_country_DF_list)

ggplot(df1_Top10_happy_country,  aes(x = Year,y = Happiness.Score,color = Country))+  geom_line()

```
## The happiness socre of Finland is increasing dramatically from 2015-2019


### The 10 most progressive countries from 2015 - 2017:
```{r}
df1 %>%
  mutate(y = as.character(Year)) %>%
  select(y, Country, Region, Happiness.Score) %>%
  pivot_wider(names_from = y, values_from = Happiness.Score,
              names_prefix = "y_") %>%
  mutate(p = (y_2019 - y_2015)/y_2015 * 100) %>%
  arrange(-p) %>%
  slice_head(n = 10) %>%
  ggplot(aes(reorder(Country, p), p)) +
  geom_point() +
  theme_bw() +
  coord_flip() +
  labs(title = "The 10 most progressive countries from 2015 - 2019",
       y = "Percentage Increase of Happiness Score", x = "")
```

```{r}
Top10_Progress_country_df = df1 %>%
  mutate(y = as.character(Year)) %>%
  select(y, Country, Region, Happiness.Score) %>%
  pivot_wider(names_from = y, values_from = Happiness.Score,
              names_prefix = "y_") %>%
  mutate(p = (y_2019 - y_2015)/y_2015 * 100) %>%
  arrange(-p) %>%
  slice_head(n = 10)

Top10_Progress_country_df_list = c(Top10_Progress_country_df$Country)

df1_Top10_Progress_country = subset(df1,Country %in% Top10_Progress_country_df_list)

ggplot(df1_Top10_Progress_country,  aes(x = Year,y = Happiness.Score,color = Country))+  geom_line()


```

```{r}
df1
```
```{r}
df1 %>%
  summarise(gdp = mean(Economy..GDP.per.Capita.),
            family = mean(Family),
            life.expectancy = mean(Health..Life.Expectancy.),
            freedom = mean(Freedom),
            generosity = mean(Generosity),
            corruption = mean(Trust..Government.Corruption.)) %>%
  pivot_longer(c(gdp, family, life.expectancy,freedom,generosity, corruption),
               names_to = "f", values_to = "value") %>%
  ggplot(aes(reorder(f, value), value)) +
  geom_bar(stat = "identity", fill = "darkgreen", width = 0.55, alpha = 0.7) +
  geom_text(aes(label = paste0(round(value, 2)), vjust = -0.5)) +
  theme_bw() +
  labs(title = "The mean value of the factors" , y = "", x = "")
```

```{r}
Happiness.Continent <- df1 %>%
                          select(-c(Year,Happiness.Rank))%>%
                          group_by(Region) %>%
                          summarise_at(vars(-Country), funs(mean(., na.rm=TRUE)))


Happiness.Continent.melt <- melt(Happiness.Continent)


# Faceting
ggplot(Happiness.Continent.melt, aes(y=value, x=Region, color=Region, fill=Region)) + 
  geom_bar( stat="identity") +    
  facet_wrap(~variable) + theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average value of happiness variables for different continents", 
       y = "Average value") 
```


```{r}
####### Happiness score for each continent

gg1 <- ggplot(df1,
              aes(x=Region,
                  y=Happiness.Score,
                  color=Region))+
  geom_point() + theme_bw() +
  theme(axis.text.x = element_text(angle = 90))

gg1

```




```{r}
gg2 <- ggplot(df1 , aes(x = Region, y = Happiness.Score)) +
  geom_boxplot(aes(fill=Region)) + theme_bw() +
  theme(axis.text.x = element_text (angle = 90))

gg2
```


```{r}
colnames(df1)
```
```{r}
ggline1 = ggplot(df1, aes(x = Economy..GDP.per.Capita., y = Happiness.Score)) + 
  geom_point(size = .5, alpha = 0.8) +  
  geom_smooth(method = "lm", fullrange = TRUE) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline1a = ggplot(df1, aes(x = Economy..GDP.per.Capita., y = Happiness.Score)) + 
  geom_point(aes(color=Region), size = .5, alpha = 0.8) +  
  geom_smooth(aes(color = Region, fill = Region), 
              method = "lm", fullrange = TRUE) +
  facet_wrap(~Region) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline1
ggline1a
```


```{r}
ggline2 = ggplot(df1, aes(x = Family, y = Happiness.Score)) + 
  geom_point(size = .5, alpha = 0.8) +  
  geom_smooth(method = "lm", fullrange = TRUE) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline2a = ggplot(df1, aes(x = Family, y = Happiness.Score)) + 
  geom_point(aes(color=Region), size = .5, alpha = 0.8) +  
  geom_smooth(aes(color = Region, fill = Region), 
              method = "lm", fullrange = TRUE) +
  facet_wrap(~Region) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline2
ggline2a
```


```{r}
ggline3 = ggplot(df1, aes(x = Health..Life.Expectancy., y = Happiness.Score)) + 
  geom_point(size = .5, alpha = 0.8) +  
  geom_smooth(method = "lm", fullrange = TRUE) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline3a = ggplot(df1, aes(x = Health..Life.Expectancy., y = Happiness.Score)) + 
  geom_point(aes(color=Region), size = .5, alpha = 0.8) +  
  geom_smooth(aes(color = Region, fill = Region), 
              method = "lm", fullrange = TRUE) +
  facet_wrap(~Region) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline3
ggline3a
  
```


```{r}
ggline4 = ggplot(df1, aes(x =Freedom, y = Happiness.Score)) + 
  geom_point(size = .5, alpha = 0.8) +  
  geom_smooth(method = "lm", fullrange = TRUE) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline4a = ggplot(df1, aes(x =Freedom, y = Happiness.Score)) + 
  geom_point(aes(color=Region), size = .5, alpha = 0.8) +  
  geom_smooth(aes(color = Region, fill = Region), 
              method = "lm", fullrange = TRUE) +
  facet_wrap(~Region) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline4
ggline4a


```


```{r}
ggline5 = ggplot(df1, aes(x = Trust..Government.Corruption., y = Happiness.Score)) + 
  geom_point(size = .5, alpha = 0.8) +  
  geom_smooth(method = "lm", fullrange = TRUE) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline5a = ggplot(df1, aes(x = Trust..Government.Corruption., y = Happiness.Score)) + 
  geom_point(aes(color=Region), size = .5, alpha = 0.8) +  
  geom_smooth(aes(color = Region, fill = Region), 
              method = "lm", fullrange = TRUE) +
  facet_wrap(~Region) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline5
ggline5a


```
```{r}
ggline6 = ggplot(df1, aes(x = Generosity, y = Happiness.Score)) + 
  geom_point(size = .5, alpha = 0.8) +  
  geom_smooth(method = "lm", fullrange = TRUE) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline6a = ggplot(df1, aes(x = Generosity, y = Happiness.Score)) + 
  geom_point(aes(color=Region), size = .5, alpha = 0.8) +  
  geom_smooth(aes(color = Region, fill = Region), 
              method = "lm", fullrange = TRUE) +
  facet_wrap(~Region) +
  theme_bw() + labs(title = "Scatter plot with regression line")

ggline6
ggline6a
```


```{r}
library(corrplot)
Num.cols <- sapply(df1, is.numeric)
Cor.data <- cor(df1[, Num.cols])

corrplot(Cor.data, method = 'color') 
 
```


```{r}
newdatacor = cor(df1[c(4:11)])
corrplot(newdatacor, method = "number")
```


```{r}
```


```{r}
```

